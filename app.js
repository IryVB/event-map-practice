/* =========================================================
   1.  –î–ê–ù–Ü (events + locations)
   ======================================================= */
const events = [
  {
    name: '–ö–æ–Ω—Ü–µ—Ä—Ç –≥—É—Ä—Ç—É XYZ',
    description: '–í–µ–ª–∏–∫–∏–π –∫–æ–Ω—Ü–µ—Ä—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ –≥—É—Ä—Ç—É XYZ –Ω–∞ –ø–ª–æ—â—ñ –ù–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.',
    date: '2025-07-10',
    type: '–ú—É–∑–∏–∫–∞',
    lat: 50.911, lng: 34.802,
    image: 'xyz-concert.png',
    link: 'events/event1.html',
    venueId: 4
  },
  {
    name: '–ö—ñ–Ω–æ–ø–æ–∫–∞–∑ –ø—Ä–æ—Å—Ç–æ –Ω–µ–±–∞',
    description: '–í–µ—á—ñ—Ä–Ω—ñ–π –∫—ñ–Ω–æ–ø–æ–∫–∞–∑ —É –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º—É –ø–∞—Ä–∫—É.',
    date: '2025-07-12',
    type: '–ö—ñ–Ω–æ',
    lat: 50.905, lng: 34.7985,
    image: 'cinema-openair.jpg',
    link: 'events/event2.html',
    venueId: 2
  },
  {
    name: '–í–∏—Å—Ç–∞–≤–∫–∞ —Ö—É–¥–æ–∂–Ω–∏–∫—ñ–≤',
    description: '–í–∏—Å—Ç–∞–≤–∫–∞ —Å—É—á–∞—Å–Ω–æ–≥–æ –∂–∏–≤–æ–ø–∏—Å—É —É –º—ñ—Å—å–∫—ñ–π –≥–∞–ª–µ—Ä–µ—ó.',
    date: '2025-07-15',
    type: '–í–∏—Å—Ç–∞–≤–∫–∞',
    lat: 50.9095, lng: 34.796,
    image: 'art-exhibition.jpg',
    link: 'events/event3.html',
    venueId: 3
  },
  {
    name: '–í—ñ–¥–∫—Ä–∏—Ç–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –π–æ–≥–∏',
    description: '–†–∞–Ω–∫–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –π–æ–≥–∏ —É –ø–∞—Ä–∫—É.',
    date: '2025-07-13',
    type: '–°–ø–æ—Ä—Ç',
    lat: 50.908, lng: 34.803,
    image: 'yoga.jpg',
    link: 'events/event4.html',
    venueId: 2
  },
  {
    name: '–õ–µ–∫—Ü—ñ—è –∑ —ñ—Å—Ç–æ—Ä—ñ—ó –º—ñ—Å—Ç–∞',
    description: '–ü—ñ–∑–Ω–∞–≤–∞–ª—å–Ω–∞ –ª–µ–∫—Ü—ñ—è –∑ —ñ—Å—Ç–æ—Ä—ñ—ó –º—ñ—Å—Ç–∞ —É –ú–æ–ª–æ–¥—ñ–∂–Ω–æ–º—É —Ü–µ–Ω—Ç—Ä—ñ.',
    date: '2025-07-14',
    type: '–ù–∞–≤—á–∞–Ω–Ω—è',
    lat: 50.9105, lng: 34.795,
    image: 'history-lecture.jpg',
    link: 'events/event5.html',
    venueId: 1
  },
  {
    name: '–ú—ñ—Å—å–∫–∏–π —Ñ–µ—Å—Ç–∏–≤–∞–ª—å –º—É–∑–∏–∫–∏',
    description: 'Open-air —Ñ–µ—Å—Ç–∏–≤–∞–ª—å –º—É–∑–∏–∫–∏ –Ω–∞ –º—ñ—Å—å–∫–æ–º—É —Å—Ç–∞–¥—ñ–æ–Ω—ñ.',
    date: '2025-07-18',
    type: '–ú—É–∑–∏–∫–∞',
    lat: 50.912, lng: 34.805,
    image: 'music-festival.jpg',
    link: 'events/event6.html',
    venueId: 5
  },
  {
    name: '–í–µ—á—ñ—Ä –∫–æ—Ä–æ—Ç–∫–æ–º–µ—Ç—Ä–∞–∂–æ–∫',
    description: '–ü–µ—Ä–µ–≥–ª—è–¥ –∫–æ—Ä–æ—Ç–∫–æ–º–µ—Ç—Ä–∞–∂–Ω–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤ —É –ú–æ–ª–æ–¥—ñ–∂–Ω–æ–º—É —Ü–µ–Ω—Ç—Ä—ñ.',
    date: '2025-07-20',
    type: '–ö—ñ–Ω–æ',
    lat: 50.9065, lng: 34.797,
    image: 'short-films.jpg',
    link: 'events/event7.html',
    venueId: 5
  },
  {
    name: '–í–∏—Å—Ç–∞–≤–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π',
    description: '–§–æ—Ç–æ–≤–∏—Å—Ç–∞–≤–∫–∞ —Å—É—á–∞—Å–Ω–∏—Ö –∞–≤—Ç–æ—Ä—ñ–≤ —É –º—ñ—Å—å–∫—ñ–π –≥–∞–ª–µ—Ä–µ—ó.',
    date: '2025-07-22',
    type: '–í–∏—Å—Ç–∞–≤–∫–∞',
    lat: 50.9088, lng: 34.7995,
    image: 'photo-exhibition.jpg',
    link: 'events/event8.html',
    venueId: 3
  },
  {
    name: '–ó–º–∞–≥–∞–Ω–Ω—è –∑ –±—ñ–≥—É',
    description: '–ú—ñ—Å—å–∫—ñ –∑–º–∞–≥–∞–Ω–Ω—è –∑ –±—ñ–≥—É —É –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º—É –ø–∞—Ä–∫—É.',
    date: '2025-07-24',
    type: '–°–ø–æ—Ä—Ç',
    lat: 50.903, lng: 34.8,
    image: 'running-competition',           // –≤–∏–ø—Ä–∞–≤–∏–≤ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è
    link: 'events/event9.html',
    venueId: 2
  },
  {
    name: '–ú–∞–π—Å—Ç–µ—Ä-–∫–ª–∞—Å –∑ –º–∞–ª—é–≤–∞–Ω–Ω—è',
    description: '–ú–∞–π—Å—Ç–µ—Ä-–∫–ª–∞—Å –∑ –∞–∫–≤–∞—Ä–µ–ª—ñ —É –•—É–¥–æ–∂–Ω—ñ–π —à–∫–æ–ª—ñ.',
    date: '2025-07-26',
    type: '–ù–∞–≤—á–∞–Ω–Ω—è',
    lat: 50.909, lng: 34.804,
    image: 'art-masterclass.jpg',
    link: 'events/event10.html',
    venueId: 1
  }
];

/* === TOP-5 –≤–∂–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—Ö –∑–∞—Ö–æ–¥—ñ–≤ ======================== */
const topEvents = [
  {
    name : '–§–µ—Å—Ç–∏–≤–∞–ª—å ‚ÄúJazz on the Lake‚Äù 2024',
    image: 'top-jazz-lake.jpg',   // –ø–æ–∫–ª–∞–¥—ñ—Ç—å —É /images
    link : '#'
  },
  {
    name : '‚ÄúSumy Color Run‚Äù ‚Äì –±–ª–∞–≥–æ–¥—ñ–π–Ω–∏–π –∑–∞–±—ñ–≥',
    image: 'top-color-run.jpg',
    link : '#'
  },
  {
    name : '–ù—ñ—á –º—É–∑–µ—ó–≤: —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –∫–≤–µ—Å—Ç',
    image: 'top-night-museum.jpg',
    link : '#'
  },
  {
    name : '–í—ñ–¥–∫—Ä–∏—Ç–∏–π —á–µ–º–ø—ñ–æ–Ω–∞—Ç –∑ –±–∞—Ä–±–µ–∫—é',
    image: 'top-bbq-champ.jpg',
    link : '#'
  },
  {
    name : 'Summer Tech Meetup 2024',
    image: 'top-tech-meetup.jpg',
    link : '#'
  }
];

const locations = [
  { id:1, name:'–ü–ª–æ—â–∞ –ù–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ',
    address:'–º. –°—É–º–∏, –ø–ª. –ù–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, 1',
    contact:'–¢–µ–ª: +380123456789',
    description:'–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –ø–ª–æ—â–∞ –º—ñ—Å—Ç–∞ –¥–ª—è –º–∞—Å–æ–≤–∏—Ö –∑–∞—Ö–æ–¥—ñ–≤.',
    image:'art-school.jpg' },
  { id:2, name:'–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –ø–∞—Ä–∫',
    address:'–º. –°—É–º–∏, –≤—É–ª. –ü–∞—Ä–∫–æ–≤–∞, 12',
    contact:'–¢–µ–ª: +380987654321',
    description:'–ü–æ–ø—É–ª—è—Ä–Ω–µ –º—ñ—Å—Ü–µ –¥–ª—è –∫—ñ–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ–±–∞.',
    image:'park.jpg' },
  { id:3, name:'–ú—ñ—Å—å–∫–∞ –≥–∞–ª–µ—Ä–µ—è',
    address:'–º. –°—É–º–∏, –≤—É–ª. –ú–∏—Å—Ç–µ—Ü—å–∫–∞, 5',
    contact:'–¢–µ–ª: +380555555555',
    description:'–ì–∞–ª–µ—Ä–µ—è —Å—É—á–∞—Å–Ω–æ–≥–æ –º–∏—Å—Ç–µ—Ü—Ç–≤–∞.',
    image:'gallery.jpg' },
  { id:4, name:'–ú—ñ—Å—å–∫–∏–π —Å—Ç–∞–¥—ñ–æ–Ω',
    address:'–º. –°—É–º–∏, –≤—É–ª. –°–ø–æ—Ä—Ç–∏–≤–Ω–∞, 3',
    contact:'–¢–µ–ª: +380112233445',
    description:'–ú—ñ—Å—Ü–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–∏—Ö —Ç–∞ –º—É–∑–∏—á–Ω–∏—Ö open-air –ø–æ–¥—ñ–π.',
    image:'stadium.jpg' },
  { id:5, name:'–ú–æ–ª–æ–¥—ñ–∂–Ω–∏–π —Ü–µ–Ω—Ç—Ä',
    address:'–º. –°—É–º–∏, –≤—É–ª. –ú–æ–ª–æ–¥—ñ–∂–Ω–∞, 10',
    contact:'–¢–µ–ª: +380223344556',
    description:'–õ–æ–∫–∞—Ü—ñ—è –¥–ª—è –ª–µ–∫—Ü—ñ–π —ñ –∫—É–ª—å—Ç—É—Ä–Ω–∏—Ö –ø–æ–¥—ñ–π.',
    image:'youth-center.jpg' }
];

/* =========================================================
   2.  –ö–ê–†–¢–ê (Leaflet)
   ======================================================= */
const map = L.map('map').setView([50.907, 34.798], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap'
}).addTo(map);

let markers = [];

/* =========================================================
   3.  –†–ï–ù–î–ï–† –°–ü–ò–°–ö–£ –ü–û–î–Ü–ô + –ú–ê–†–ö–ï–†–Ü–í
   ======================================================= */
function renderEventList(arr){
  const list = document.getElementById('event-list');
  if(!list) return;
  list.innerHTML = '';

  arr.forEach(ev=>{
    const card = document.createElement('div');
    card.className = 'event-card';
    card.innerHTML = `
      <img src="images/${ev.image}" alt="${ev.name}">
      <div class="event-details">
        <h3>${ev.name}</h3>
        <p>${ev.description}</p>
        <div class="event-meta">
          <span>üìÖ ${ev.date}</span>
          <span>üìÇ ${ev.type}</span>
        </div>
        <a class="detail-button" href="${ev.link}">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
      </div>`;
    list.appendChild(card);
  });
}

function renderMapMarkers(arr){
  markers.forEach(m=>map.removeLayer(m));
  markers = [];

  arr.forEach(ev=>{
    const marker = L.marker([ev.lat, ev.lng]).addTo(map)
                   .bindPopup(`<b>${ev.name}</b><br>${ev.date}<br>${ev.type}`);
    marker.on('click', ()=> openModal(ev));
    markers.push(marker);
  });
}

/* –ø–µ—Ä—à–æ—á–µ—Ä–≥–æ–≤–∏–π —Ä–µ–Ω–¥–µ—Ä ¬´–∂–∏–≤–∏—Ö¬ª –ø–æ–¥—ñ–π */
renderEventList(events);
renderMapMarkers(events);

/* ===== 3-bis.  –†–µ–Ω–¥–µ—Ä TOP-5 ================================= */
function renderTop5(){
  const grid = document.getElementById('top-grid');
  if(!grid) return;
  grid.innerHTML = '';

  topEvents.forEach((ev,i)=>{
    const card = document.createElement('a');
    card.href = ev.link;
    card.className = 'top-card';
    card.innerHTML = `
      <span class="top-badge">${i+1}</span>
      <img src="images/${ev.image}" alt="${ev.name}">
      <span class="top-caption">${ev.name}</span>`;
    grid.appendChild(card);
  });
}

/* =========================================================
   4.  –§–Ü–õ–¨–¢–†–ò  +  –ü–û–®–£–ö
   ======================================================= */
const searchInput = document.getElementById('searchInput');

/* 1) –ó–∞–≥–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è */
function applyFilters(){
  const cat   = document.getElementById('category').value;
  const date  = document.getElementById('date').value;
  const query = searchInput.value.trim().toLowerCase();

  const filtered = events.filter(ev=>{
    const okCat  = cat==='all' || ev.type === cat;
    const okDate = !date || ev.date === date;
    const okName = !query || ev.name.toLowerCase().includes(query);
    return okCat && okDate && okName;
  });

  renderEventList(filtered);
  renderMapMarkers(filtered);
}

/* 2) –ö–Ω–æ–ø–∫–∞ ¬´–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏¬ª */
document.getElementById('filterButton')
        .addEventListener('click', e=>{
          e.preventDefault();
          applyFilters();
        });

/* 3) –°–∞–±–º—ñ—Ç —Ñ–æ—Ä–º–∏ –ø–æ—à—É–∫—É */
document.getElementById('searchForm')
        .addEventListener('submit', e=>{
          e.preventDefault();
          const q = searchInput.value.trim().toLowerCase();
          if(!q){ applyFilters(); return; }

          const exact  = events.find(ev=>ev.name.toLowerCase()===q);
          const inside = events.find(ev=>ev.name.toLowerCase().includes(q));
          const target = exact || inside;

          if(target && target.link){
            window.location.href = target.link;
          }else{
            alert('–ù–∞ –∂–∞–ª—å, –ø–æ–¥—ñ—é –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòï');
            applyFilters();
          }
        });

searchInput.addEventListener('input', applyFilters);

/* =========================================================
   5.  TOGGLE –°–ü–ò–°–ö–£
   ======================================================= */
const toggleHdr = document.getElementById('toggle-event-list');
const eventDiv  = document.getElementById('event-list');
toggleHdr.addEventListener('click', ()=>{
  eventDiv.classList.toggle('active');
  toggleHdr.textContent = eventDiv.classList.contains('active')
    ? '–°–ø–∏—Å–æ–∫ –ø–æ–¥—ñ–π ‚ñ≤' : '–°–ø–∏—Å–æ–∫ –ø–æ–¥—ñ–π ‚ñº';
});

/* =========================================================
   6.  MODAL
   ======================================================= */
const modal      = document.getElementById('eventModal');
const modalTitle = document.getElementById('modal-title');
const modalImg   = document.getElementById('modal-image');
const modalDesc  = document.getElementById('modal-description');
const modalDate  = document.getElementById('modal-date');
const modalType  = document.getElementById('modal-type');
const closeBtn   = document.querySelector('.close-button');

const venueBox   = document.getElementById('venue-info');
const vName   = document.getElementById('modal-venue-name');
const vAddr   = document.getElementById('modal-venue-address');
const vCont   = document.getElementById('modal-venue-contact');
const vDescr  = document.getElementById('modal-venue-description');
const vImg    = document.getElementById('modal-venue-image');

function openModal(ev){
  modalTitle.textContent = ev.name;
  modalImg.src  = `images/${ev.image}`;
  modalImg.alt  = ev.name;
  modalDesc.textContent = ev.description;
  modalDate.textContent = `üìÖ –î–∞—Ç–∞: ${ev.date}`;
  modalType.textContent = `üìÇ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${ev.type}`;

  const venue = locations.find(l=>l.id===ev.venueId);
  if(venue){
    vName.textContent  = `üèõ –ó–∞–∫–ª–∞–¥: ${venue.name}`;
    vAddr.textContent  = `üìç –ê–¥—Ä–µ—Å–∞: ${venue.address}`;
    vCont.textContent  = `üìû –ö–æ–Ω—Ç–∞–∫—Ç: ${venue.contact}`;
    vDescr.textContent = `‚ÑπÔ∏è ${venue.description}`;
    vImg.src   = `images/${venue.image}`;
    vImg.alt   = venue.name;
    venueBox.style.display = 'block';
  }else{
    venueBox.style.display = 'none';
  }

  modal.style.display = 'flex';
}
closeBtn.addEventListener('click', ()=> modal.style.display='none');
window.addEventListener('click', e=>{
  if(e.target===modal) modal.style.display='none';
});

/* =========================================================
   7.  SWIPER
   ======================================================= */
document.addEventListener('DOMContentLoaded', ()=>{
  const swiper = new Swiper('.mySwiper',{
    slidesPerView:3,
    spaceBetween:32,
    loop:true,
    speed:800,
    autoplay:{delay:2500, disableOnInteraction:false},
    pagination:{el:'.swiper-pagination', clickable:true},
    navigation:{nextEl:'.swiper-button-next', prevEl:'.swiper-button-prev'},
    breakpoints:{0:{slidesPerView:1.1},600:{slidesPerView:2},900:{slidesPerView:3}}
  });

  swiper.on('click', sw=>{
    const idx = sw.clickedSlide?.dataset.index;
    if(idx!==undefined) openModal(events[idx]);
  });

  /* ‚¨á‚¨á –º–∞–ª—é—î–º–æ –¢–û–ü-5 –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DOM */
  renderTop5();
});

/* =========================================================
   8.  BURGER-–ú–ï–ù–Æ
   ======================================================= */
const burgerBtn = document.getElementById('burger');
const navMenu   = document.querySelector('.nav-menu');
const mainNav   = document.querySelector('.main-nav');

burgerBtn?.addEventListener('click', ()=> mainNav.classList.toggle('menu-open'));
navMenu?.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', ()=> mainNav.classList.remove('menu-open'));
});
